# V2优化版 - 分布式对象存储系统

## 🏗️ 架构优化说明

### 优化前的问题
1. **单点故障**：API服务器只有一个实例
2. **紧耦合**：服务发现逻辑散布在各个组件中
3. **可维护性差**：代码结构不够清晰
4. **扩展性限制**：难以水平扩展

### 优化后的改进
1. **服务注册中心**：统一的服务发现机制
2. **健康检查**：独立的健康监控服务
3. **配置管理**：集中化的配置管理
4. **负载均衡**：支持多API服务器实例
5. **监控告警**：完整的监控体系

## 📁 目录结构

```
v2-optimized/
├── cmd/                    # 应用程序入口
│   ├── apiserver/         # API服务器
│   ├── dataserver/        # 数据服务器
│   └── registry/          # 服务注册中心
├── internal/              # 内部包
│   ├── config/           # 配置管理
│   ├── discovery/        # 服务发现
│   ├── health/           # 健康检查
│   ├── loadbalancer/     # 负载均衡
│   └── storage/          # 存储抽象
├── pkg/                   # 公共包
│   ├── api/              # API定义
│   ├── client/           # 客户端SDK
│   └── utils/            # 工具函数
├── deployments/           # 部署配置
│   ├── docker/           # Docker配置
│   └── k8s/              # Kubernetes配置
└── scripts/               # 脚本文件
    ├── build.sh          # 构建脚本
    └── deploy.sh         # 部署脚本
```

## 🔧 核心组件

### 1. 服务注册中心 (Registry)
- 统一管理所有服务实例
- 提供服务注册和发现API
- 支持服务健康检查
- 数据持久化存储

### 2. API服务器 (API Server)
- 处理客户端请求
- 负载均衡到数据服务器
- 请求路由和转发
- 认证和授权

### 3. 数据服务器 (Data Server)
- 实际的对象存储
- 向注册中心注册服务
- 定期健康检查报告
- 数据备份和恢复

### 4. 负载均衡器 (Load Balancer)
- 多种负载均衡算法
- 健康检查集成
- 故障转移机制
- 性能监控

## 🚀 部署方式

### 开发环境
```bash
# 启动服务注册中心
make start-registry

# 启动数据服务器
make start-dataserver

# 启动API服务器
make start-apiserver
```

### 生产环境
```bash
# Docker部署
docker-compose up -d

# Kubernetes部署
kubectl apply -f deployments/k8s/
```

## 📊 监控指标

- 服务可用性
- 请求响应时间
- 存储容量使用率
- 网络流量统计
- 错误率统计

## 🔍 技术特性

- **高可用**：多实例部署，无单点故障
- **可扩展**：水平扩展支持
- **可观测**：完整的监控和日志
- **容错性**：故障自动恢复
- **性能**：优化的负载均衡和缓存
